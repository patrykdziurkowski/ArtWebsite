@using web.Features.Artists.Index
@model ArtistProfileModel

<div id="boosted-art-piece-container">
    @if (Model.BoostExpirationDate is not null)
    {
        <div class="boosted-art-piece">
            <img src="@Model.BoostedArtPiecePath" alt="Boosted Art Piece">
            @if (Model.IsOwner)
            {
                <span class="boost-expiration">Expires on @Model.BoostExpirationDate</span>
            }
        </div>
    }
</div>

<script>
    function boostArtPiece(artPieceId) {
        fetch('/api/artist/boost', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                artPieceId: artPieceId
            }),
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error("Response from boosting art piece was not ok.");
                }

                return response.json();
            })
            .then(responseObject => {
                const boost = responseObject;
                const container = document.querySelector("#boosted-art-piece-container");

                const boostedImage = document.createElement("div");
                boostedImage.className = "boosted-art-piece";
                boostedImage.textContent = '';

                const img = document.createElement('img');
                img.src = boost.imagePath;
                img.alt = 'Boosted Art Piece';
                boostedImage.appendChild(img);

                const expirationSpan = document.createElement('span');
                expirationSpan.className = 'boost-expiration';
                expirationSpan.textContent = `Expires on ${boost.expirationDate}`;
                boostedImage.appendChild(expirationSpan);
                
                container.appendChild(boostedImage);
                const boostButtons = document.querySelectorAll(".boost-btn");
                for (const button of boostButtons) {
                    button.remove();
                }
            })
            .catch(() => alert('Error boosting art piece.'));
    }
</script>