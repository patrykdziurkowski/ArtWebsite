@using web.Features.Artists.Index
@model ArtistProfileModel

<div id="boosted-art-piece-container" class="mb-4">
    @if (Model.BoostExpirationDate is not null)
    {
        <div class="boost-wrapper" data-art-piece-id="@Model.BoostedArtPieceId">
            <div class="boost-ribbon">
                <i class="bi bi-star-fill me-1"></i> FEATURED
            </div>

            <div class="card boost-card border-0 shadow-lg">
                <div class="boost-image-wrapper">
                    <img src="@Model.BoostedArtPiecePath"
                        alt="Boosted Art Piece"
                        class="boost-image">
                </div>

                @if (Model.IsOwner)
                {
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <small class="boost-expiration text-muted">
                            <i class="bi bi-clock me-1"></i>
                            Expires @Model.BoostExpirationDate.Value.ToLocalTime().ToString("MMM dd, yyyy h:mm tt")
                        </small>

                        <span class="boost-badge">
                            <i class="bi bi-lightning-fill me-1"></i> Boost Active
                        </span>
                    </div>
                }
            </div>
        </div>
    }
</div>

<style>
    .boost-wrapper {
        position: relative;
        padding: 4px;
        border-radius: 18px;
        background: linear-gradient(135deg, #ff006e, #8338ec, #3a86ff);
        background-size: 300% 300%;
        animation: pink-glow 6s ease infinite;
    }

    .boost-wrapper::before {
        content: "";
        position: absolute;
        inset: -6px;
        border-radius: 22px;
        background: radial-gradient(circle at top left,
            rgba(255, 0, 110, 0.4),
            transparent 60%);
        z-index: -1;
        filter: blur(20px);
    }

    .boost-card {
        border-radius: 16px;
        overflow: hidden;
        background: var(--bs-body-bg);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .boost-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    }

    .boost-image-wrapper {
        overflow: hidden;
    }

    .boost-image {
        width: 100%;
        height: 320px;
        object-fit: cover;
        transition: transform 0.6s ease;
    }

    .boost-card:hover .boost-image {
        transform: scale(1.05);
    }

    .boost-ribbon {
        position: absolute;
        top: 16px;
        left: -8px;
        background: linear-gradient(45deg, #ffbe0b, #ff006e);
        color: white;
        font-weight: 600;
        padding: 6px 16px;
        font-size: 0.75rem;
        border-radius: 6px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        z-index: 2;
    }

    .boost-badge {
        background: linear-gradient(45deg, #ff006e, #8338ec);
        color: white;
        padding: 6px 12px;
        font-size: 0.75rem;
        border-radius: 999px;
        font-weight: 500;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        let artPieceDetails = null;
        const container = document.querySelector('#boosted-art-piece-container');
        const boostWrapper = container.querySelector('.boost-wrapper');
        if (boostWrapper) {
            container.addEventListener('click', (e) => {
                const artPieceId = boostWrapper.dataset.artPieceId;
                artPieceDetails = new ArtPieceDetails(artPieceId);
                artPieceDetails.show();
            });
        }
    });

    function boostArtPiece(artPieceId) {
        fetch('/api/artist/boost', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                artPieceId: artPieceId
            }),
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error("Response from boosting art piece was not ok.");
                }

                return response.json();
            })
            .then(boost => {
                const container = document.querySelector("#boosted-art-piece-container");

                const formattedDate = new Date(boost.expirationDate)
                    .toLocaleString('en-US', {
                        month: 'short',
                        day: '2-digit',
                        year: 'numeric',
                        hour: 'numeric',
                        minute: '2-digit',
                        hour12: true
                    });

                container.innerHTML = `
                    <div class="boost-wrapper" data-art-piece-id="${boost.artPieceId.value}">
                        <div class="boost-ribbon">
                            <i class="bi bi-star-fill me-1"></i> FEATURED
                        </div>

                        <div class="card boost-card border-0 shadow-lg">
                            <div class="boost-image-wrapper">
                                <img src="${boost.imagePath}"
                                    alt="Boosted Art Piece"
                                    class="boost-image">
                            </div>

                            <div class="card-body d-flex justify-content-between align-items-center">
                                <small class="boost-expiration text-muted">
                                    <i class="bi bi-clock me-1"></i>
                                    Expires ${formattedDate}
                                </small>

                                <span class="boost-badge">
                                    <i class="bi bi-lightning-fill me-1"></i> Boost Active
                                </span>
                            </div>
                        </div>
                    </div>
                `;

                const wrapper = container.querySelector('.boost-wrapper');
                wrapper.addEventListener('click', () => {
                    const artPieceDetails = new ArtPieceDetails(boost.artPieceId.value);
                    artPieceDetails.show();
                });

                document.querySelectorAll(".boost-btn").forEach(b => b.remove());
            })
            .catch(() => alert('Error boosting art piece.'));
    }
</script>